#!/usr/bin/env bash

### IMPORTANT!!!
### Keep this file in sync with action.yml

# These are magic workflow commands for GitHub Actions
# Docs: https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#grouping-log-lines
echo "::group::Creating PDFs"
grep -l "window\.PrimerSpecConfig" _site/**/*.html _site/*.html | while read -r file
do
  relativePath=${file#_site/}
  pdfFile="_site/assets/primer-spec-pdf/${relativePath%.html}.pdf"
  pdfFileDir=${pdfFile%/*}
  echo "Source: $file"
  echo "Dest: $pdfFile"
  echo "In directory: $pdfFileDir"
  echo ""
  mkdir -p $pdfFileDir
  chrome --headless --disable-gpu --run-all-compositor-stages-before-draw --virtual-time-budget=1000 --print-to-pdf-no-header --print-to-pdf="$pdfFile" $file
done
echo "::endgroup::"
